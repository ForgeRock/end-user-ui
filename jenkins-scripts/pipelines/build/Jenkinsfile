#!/usr/bin/env groovy

@Library(value=['forgerock-pipeline-libs@bcf48f0eb1d45a1be59678acf6270532996e0329', 'QaUtils'], changelog=false)

def pipeline

timestamps {

  node('gce-vm-idm') {

    stage ('Clone repo') {

      checkout scm

      ENDUSER_VERSION = readMavenPom(file: 'pom.xml').version

      def jobLocation = "${env.WORKSPACE}/jenkins-scripts/pipelines/build"

      if (isPR()) {
        pipeline = load("${jobLocation}/pr.groovy")
      } else {
        pipeline = load("${jobLocation}/postcommit.groovy")
      }

    }

    pipeline.build()

  }

}
