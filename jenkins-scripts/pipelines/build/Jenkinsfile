#!/usr/bin/env groovy

@Library(value=['forgerock-pipeline-libs@ea988b52a8b1fc6bc4c9eed4ff06a7c958190ad9', 'QaUtils'], changelog=false)

def pipeline

timestamps {

  node('build&&linux') {

    stage ('Clone repo') {

      checkout scm

      ENDUSER_VERSION = readMavenPom(file: 'pom.xml').version

      def jobLocation = "${env.WORKSPACE}/jenkins-scripts/pipelines/build"

      if (isPR()) {
        pipeline = load("${jobLocation}/pr.groovy")
      } else {
        pipeline = load("${jobLocation}/postcommit.groovy")
      }

    }

    pipeline.build()

  }

}
