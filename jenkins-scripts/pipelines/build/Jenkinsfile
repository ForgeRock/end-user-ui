#!/usr/bin/env groovy

@Library(value=['forgerock-pipeline-libs@3d01db87f911d1a9d1d2039aa4f51ace927b374d', 'QaUtils'], changelog=false)

def pipeline

timestamps {

  node('build&&linux') {

    stage ('Clone repo') {

      checkout scm

      ENDUSER_VERSION = readMavenPom(file: 'pom.xml').version

      def jobLocation = "${env.WORKSPACE}/jenkins-scripts/pipelines/build"

      if (isPR()) {
        pipeline = load("${jobLocation}/pr.groovy")
      } else {
        pipeline = load("${jobLocation}/postcommit.groovy")
      }

    }

    pipeline.build()

  }

}
